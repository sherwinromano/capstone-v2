{% load static tailwind_tags %}

<!DOCTYPE html>
<html lang="en">
  <head>
    <link
      rel="shortcut icon"
      type="x-icon"
      href="{% static 'images/CTU_logo.png' %}"
    />
    <title>
      {% block title %}STUDENT LIFE INFORMATION SYSTEM{% endblock %}
    </title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="{% static 'styles/fontawesome-free-6.5.2-web/css/all.min.css' %}"
    />
    {% tailwind_css %}
    <link rel="stylesheet" href="{% static 'styles/base.css' %}" />
    {% block extra_css %}{% endblock %}
  </head>
  <body>
    <main
      class="relative overflow-hidden h-screen {% if user.is_superuser or user.is_staff %}xs:flex xs:flex-col lg:flex-row {% else %} flex flex-col{% endif %}"
    >
      <nav id="navbar"
        class="bg-[#fff] {% if user.is_superuser or user.is_staff %}flex xs:flex-row xs:justify-between lg:justify-normal lg:flex-col xs:w-full lg:w-[30%]{% else %}flex justify-between h-[5rem]{% endif %}"
      >
        <div class="flex gap-2 p-4 items-stretch bg-[#3b82f6] {% if user.is_superuser or user.is_staff %} justify-center {% else %} justify-normal {% endif %}">
          <img class="h-full {% if user.is_superuser or user.is_staff %} size-14 {% else %} size-min {% endif %}" src="{% static 'images/CTU_logo.png' %}" />
          <h1 class="font-bold text-[1.3rem] self-center tracking-tight text-white">HealthHub Connect</h1>
        </div>
        <ul class="xs:hidden {% if user.is_superuser or user.is_staff %} lg:flex flex-col {% else %} lg:flex {% endif %}">
          {% if user.is_superuser or user.is_staff %}
          <li>
            <a class="flex justify-center items-center h-full tracking-tight hover:bg-[#f0f0f0] py-4 font-medium hover:border-r-[4px] hover:border-[#3b82f6] transition-all" href="{% url 'main:admin_dashboard' %}">Dashboard</a>
          </li>
          <li>
            <a class="flex justify-center items-center h-full tracking-tight hover:bg-[#f0f0f0] py-4 font-medium hover:border-r-[4px] hover:border-[#3b82f6] transition-all" href="{% url 'medical:patient_profile' %}">Patient Profile</a>
          </li>
          <li><a class="flex justify-center items-center h-full tracking-tight hover:bg-[#f0f0f0] py-4 font-medium hover:border-r-[4px] hover:border-[#3b82f6] transition-all" href="{% url 'medical:viewrequest' %}">View Requests</a></li>
          <li>
            <a class="flex justify-center items-center h-full tracking-tight hover:bg-[#f0f0f0] py-4 font-medium hover:border-r-[4px] hover:border-[#3b82f6] transition-all" href="{% url 'medical:medtracker' %}"
              >Student Medical Requirements Tracker</a
            >
          </li>
          <li>
            <a class="flex justify-center items-center h-full tracking-tight hover:bg-[#f0f0f0] py-4 font-medium hover:border-r-[4px] hover:border-[#3b82f6] transition-all" href="{% url 'medical:emergency_asst' %}"
              >Emergency Health Assistance</a
            >
          </li>
          <li><a class="flex justify-center items-center h-full tracking-tight hover:bg-[#f0f0f0] py-4 font-medium hover:border-r-[4px] hover:border-[#3b82f6] transition-all" href="{% url 'medical:pwdlist' %}">PWD Profile</a></li>
          <li>
            <a class="flex justify-center items-center h-full tracking-tight hover:bg-[#f0f0f0] py-4 font-medium hover:border-r-[4px] hover:border-[#3b82f6] transition-all" href="{% url 'medical:dentalrequest' %}">Dental Services</a>
          </li>
          <li>
            <a class="flex justify-center items-center h-full tracking-tight hover:bg-[#f0f0f0] py-4 font-medium hover:border-r-[4px] hover:border-[#3b82f6] transition-all" href="{% url 'medical:prescription' %}">Prescription Issuance</a>
          </li>
          <li>
            <a class="flex justify-center items-center h-full tracking-tight hover:bg-[#f0f0f0] py-4 font-medium hover:border-r-[4px] hover:border-[#3b82f6] transition-all" href="{% url 'medical:transactions' %}">Transaction Reports</a>
          </li>
          {% else %}
          <li>
            <a class="flex justify-center items-center h-full tracking-tight hover:bg-[#f0f0f0] px-4 font-medium hover:border-b-[4px] hover:border-[#3b82f6] transition-all" href="{% url 'main:student_dashboard' %}">Dashboard</a>
          </li>
          <li>
            <a class="flex justify-center items-center h-full tracking-tight hover:bg-[#f0f0f0] px-4 font-medium hover:border-b-[4px] hover:border-[#3b82f6] transition-all" href="{% url 'medical:request' %}">Documentary Request</a>
          </li>
          <li>
            <a class="flex justify-center items-center h-full tracking-tight hover:bg-[#f0f0f0] px-4 font-medium hover:border-b-[4px] hover:border-[#3b82f6] transition-all" href="{% url 'medical:medtracker' %}"
              >Medical Requirements Upload</a
            >
          </li>
          <!-- <li><a href="{% url 'medical:insurance_eligibility' %}">Emergency Health Assistance</a></li> -->
          <li>
            <a class="flex justify-center items-center h-full tracking-tight hover:bg-[#f0f0f0] px-4 font-medium hover:border-b-[4px] hover:border-[#3b82f6] transition-all" href="{% url 'medical:dentalservice' %}"
              >Dental Services Availment</a
            >
          </li>
          {% endif %}
        </ul>
        <svg
            id="toggleMenuBtn"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            class="xs:block lg:hidden size-8 self-center cursor-pointer mr-4"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"
            />
        </svg>
      </nav>
      <section class="bg-[#E5F2FF] h-full w-full flex xs:p-4 lg:p-[1.5rem]{% if user.is_superuser or user.is_staff %} overflow-auto{% else %} justify-center items-center overflow-hidden{% endif %}">
          {% block content %} {% endblock %}
      </section>
      <div id="sidebar-nav" class="absolute bg-[#fff] top-0 right-0 z-50 translate-x-full transition-all duration-300 h-full xs:w-[80%] md:w-1/2 p-4 flex flex-col gap-4">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="#000"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            class="size-5 close-btn cursor-pointer"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M6 18 18 6M6 6l12 12"
            />
          </svg>
          <nav class="h-fit">
            <ul class="flex flex-col gap-2">
              {% if user.is_superuser or user.is_staff %}
              <li class="menu-item border-b border-[#e6e6e6] flex">
                <a class="p-3 font-bold text-black w-full" href="{% url 'main:admin_dashboard' %}">Dashboard</a>
              </li>
              <li class="menu-item border-b border-[#e6e6e6] flex">
                <a class="p-3 font-bold text-black w-full" href="{% url 'medical:patient_profile' %}"
                  >Patient Profile</a
                >
              </li>
              <li class="menu-item border-b border-[#e6e6e6] flex">
                <a class="p-3 font-bold text-black w-full" href="{% url 'medical:viewrequest' %}">View Requests</a>
              </li>
              <li class="menu-item border-b border-[#e6e6e6] flex">
                <a class="p-3 font-bold text-black w-full" href="{% url 'medical:medtracker' %}"
                  >Student Medical Requirements Tracker</a
                >
              </li>
              <li class="menu-item border-b border-[#e6e6e6] flex">
                <a class="p-3 font-bold text-black w-full" href="{% url 'medical:emergency_asst' %}"
                  >Emergency Health Assistance</a
                >
              </li>
              <li class="menu-item border-b border-[#e6e6e6] flex">
                <a class="p-3 font-bold text-black w-full" href="{% url 'medical:pwdlist' %}">PWD Profile</a>
              </li>
              <li class="menu-item border-b border-[#e6e6e6] flex">
                <a class="p-3 font-bold text-black w-full" href="{% url 'medical:dentalrequest' %}">Dental Services</a>
              </li>
              <li class="menu-item border-b border-[#e6e6e6] flex">
                <a class="p-3 font-bold text-black w-full" href="{% url 'medical:prescription' %}"
                  >Prescription Issuance</a
                >
              </li>
              <li class="menu-item border-b border-[#e6e6e6] flex">
                <a class="p-3 font-bold text-black w-full" href="{% url 'medical:transactions' %}"
                  >Transaction Reports</a
                >
              </li>
              {% else %}
              <li class="menu-item border-b border-[#e6e6e6] flex">
                <a class="p-3 font-bold text-black w-full" href="{% url 'main:student_dashboard' %}">Dashboard</a>
              </li>
              <li class="menu-item border-b border-[#e6e6e6] flex">
                <a class="p-3 font-bold text-black w-full" href="{% url 'medical:request' %}">Documentary Request</a>
              </li>
              <li class="menu-item border-b border-[#e6e6e6] flex">
                <a class="p-3 font-bold text-black w-full" href="{% url 'medical:medtracker' %}"
                  >Medical Requirements Upload</a
                >
              </li>
              <li class="menu-item border-b border-[#e6e6e6] flex">
                <a class="p-3 font-bold text-black w-full" href="{% url 'medical:dentalservice' %}"
                  >Dental Services Availment</a
                >
              </li>
              {% endif %}
            </ul>
          </nav>
      </div>
      <div id="overlay" class="absolute top-0 right-0 bottom-0 left-0 h-full z-10 bg-[#00000050] hidden"></div>
    </main>
    <script>
      const sidebar = document.querySelector("#sidebar-nav");
      const overlay = document.querySelector("#overlay");

      document.querySelector("#toggleMenuBtn").addEventListener("click", () => {
        sidebar.classList.replace("translate-x-full", "translate-x-0");
        overlay.classList.replace("hidden", "block");
      });

      document.querySelector(".close-btn").addEventListener("click", () => {
        sidebar.classList.replace("translate-x-0", "translate-x-full");
        overlay.classList.replace("block", "hidden");
      });

      document.querySelector(".menu-item").addEventListener("click", () => {
        sidebar.classList.replace("translate-x-0", "translate-x-full");
        overlay.classList.replace("block", "hidden");
      });
    </script>
    <script src="{% static 'scripts/jquery/jquery-3.7.1.min.js' %}"></script>
    <script src="{% static 'scripts/newmain.js' %}"></script>
    {% block extra_js %}{% endblock %}
    {% if user.is_authenticated %}
        {% if user.is_staff %}
            <!-- Admin Dashboard Section -->
            <!-- <div class="row">
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">Total Patients</h5>
                            <p class="card-text">{{ total_patients }}</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">Pending Clearances</h5>
                            <p class="card-text">{{ pending_clearances }}</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row mt-4">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            Recent Examinations
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Student ID</th>
                                            <th>Name</th>
                                            <th>Date</th>
                                            <th>Action</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for exam in recent_examinations %}
                                        <tr>
                                            <td>{{ exam.student.student_id }}</td>
                                            <td>{{ exam.student.get_full_name }}</td>
                                            <td>{{ exam.date_created|date:"F d, Y" }}</td>
                                            <td>
                                                <button class="btn btn-primary btn-sm">View Details</button>
                                            </td>
                                        </tr>
                                        {% empty %}
                                        <tr>
                                            <td colspan="4" class="text-center">No recent examinations found.</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div> -->
        {% else %}
            <!-- Student Dashboard Section -->
            {% if patient %}
            <div class="row">
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-header">
                            Personal Information
                        </div>
                        <div class="card-body">
                            <p><strong>Age:</strong> {{ patient.age }}</p>
                            <p><strong>Blood Type:</strong> {{ patient.bloodtype }}</p>
                            <p><strong>Height:</strong> {{ patient.height }} cm</p>
                            <p><strong>Weight:</strong> {{ patient.weight }} kg</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-header">
                            Medical History
                        </div>
                        <div class="card-body">
                            {% if medical_history %}
                                <ul class="list-unstyled">
                                    {% if medical_history.tuberculosis %}<li>✓ Tuberculosis</li>{% endif %}
                                    {% if medical_history.hypertension %}<li>✓ Hypertension</li>{% endif %}
                                    {% if medical_history.heart_disease %}<li>✓ Heart Disease</li>{% endif %}
                                    {% if medical_history.asthma %}<li>✓ Asthma</li>{% endif %}
                                </ul>
                            {% else %}
                                <p>No medical history recorded.</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-header">
                            Risk Assessment
                        </div>
                        <div class="card-body">
                            {% if risk_assessment %}
                                <ul class="list-unstyled">
                                    {% if risk_assessment.cardiovascular_disease %}
                                        <li>✓ Cardiovascular Disease</li>
                                    {% endif %}
                                    {% if risk_assessment.chronic_lung_disease %}
                                        <li>✓ Chronic Lung Disease</li>
                                    {% endif %}
                                    {% if risk_assessment.pwd %}
                                        <li>✓ PWD: {{ risk_assessment.disability }}</li>
                                    {% endif %}
                                </ul>
                            {% else %}
                                <p>No risk assessment recorded.</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            {% else %}
                <div class="alert alert-warning">
                    No medical records found. Please complete your medical form.
                    <a href="{% url 'main:patient_form' %}" class="btn btn-primary ml-3">Complete Medical Form</a>
                </div>
            {% endif %}
        {% endif %}
    {% endif %}
  </body>
</html>
