{% load static %}

<!DOCTYPE html>
<html>
  <head>
    <link
      rel="shortcut icon"
      type="x-icon"
      href="{% static 'images/CTU_logo.png' %}"
    />
    <title>
      {% block title %}STUDENT LIFE INFORMATION SYSTEM{% endblock %}
    </title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"> -->
    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
        integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA=="
        crossorigin="anonymous" referrerpolicy="no-referrer"> -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="{% static 'styles/fontawesome-free-6.5.2-web/css/all.min.css' %}"
    />
    <link rel="stylesheet" href="{% static 'styles/mainv2.css' %}" />
    {% block extra_css %}{% endblock %}
  </head>
  <body>
    <main
      class="{% if user.is_superuser or user.is_staff %}admin-container main-container{% else %}user-container main-container{% endif %}"
    >
      <nav
        class="{% if user.is_superuser or user.is_staff %}admin-nav{% else %}user-nav{% endif %}"
      >
        <div>
          <img src="{% static 'images/CTU_logo.png' %}" class="logo" />
          <h1>HealthHub Connect</h1>
        </div>
        <ul>
          {% if user.is_superuser or user.is_staff %}
          <li>
            <a href="{% url 'main:admin_dashboard' %}">Dashboard</a>
          </li>
          <li>
            <a href="{% url 'medical:patient_profile' %}">Patient Profile</a>
          </li>
          <li><a href="{% url 'medical:viewrequest' %}">View Requests</a></li>
          <li>
            <a href="{% url 'medical:medtracker' %}"
              >Student Medical Requirements Tracker</a
            >
          </li>
          <li>
            <a href="{% url 'medical:emergency_asst' %}"
              >Emergency Health Assistance</a
            >
          </li>
          <li><a href="{% url 'medical:pwdlist' %}">PWD Profile</a></li>
          <li>
            <a href="{% url 'medical:dentalrequest' %}">Dental Services</a>
          </li>
          <li>
            <a href="{% url 'medical:prescription' %}">Prescription Issuance</a>
          </li>
          <li>
            <a href="{% url 'medical:transactions' %}">Transaction Reports</a>
          </li>
          {% else %}
          <li>
            <a href="{% url 'main:student_dashboard' %}">Dashboard</a>
          </li>
          <li>
            <a href="{% url 'medical:request' %}">Documentary Request</a>
          </li>
          <li>
            <a href="{% url 'medical:medtracker' %}"
              >Medical Requirements Upload</a
            >
          </li>
          <!-- <li><a href="{% url 'medical:insurance_eligibility' %}">Emergency Health Assistance</a></li> -->
          <li>
            <a href="{% url 'medical:dentalservice' %}"
              >Dental Services Availment</a
            >
          </li>
          {% endif %}

          <br /><br /><br /><br />
        </ul>
      </nav>
      <section>
        <div class="mobile-menu">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"
            />
          </svg>
        </div>
        <div class="content-page">{% block content %} {% endblock %}</div>
        <div class="sidebar-nav hidden">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            class="size-6 close-btn"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M6 18 18 6M6 6l12 12"
            />
          </svg>
          <nav>
            <div>
              <img src="{% static 'images/CTU_logo.png' %}" class="logo" />
              <h1>HealthHub Connect</h1>
            </div>
            <ul>
              {% if user.is_superuser or user.is_staff %}
              <li class="menu-item">
                <a href="{% url 'main:admin_dashboard' %}">Dashboard</a>
              </li>
              <li class="menu-item">
                <a href="{% url 'medical:patient_profile' %}"
                  >Patient Profile</a
                >
              </li>
              <li class="menu-item">
                <a href="{% url 'medical:viewrequest' %}">View Requests</a>
              </li>
              <li class="menu-item">
                <a href="{% url 'medical:medtracker' %}"
                  >Student Medical Requirements Tracker</a
                >
              </li>
              <li class="menu-item">
                <a href="{% url 'medical:emergency_asst' %}"
                  >Emergency Health Assistance</a
                >
              </li>
              <li class="menu-item">
                <a href="{% url 'medical:pwdlist' %}">PWD Profile</a>
              </li>
              <li class="menu-item">
                <a href="{% url 'medical:dentalrequest' %}">Dental Services</a>
              </li>
              <li class="menu-item">
                <a href="{% url 'medical:prescription' %}"
                  >Prescription Issuance</a
                >
              </li>
              <li class="menu-item">
                <a href="{% url 'medical:transactions' %}"
                  >Transaction Reports</a
                >
              </li>
              {% else %}
              <li class="menu-item">
                <a href="{% url 'main:student_dashboard' %}">Dashboard</a>
              </li>
              <li class="menu-item">
                <a href="{% url 'medical:request' %}">Documentary Request</a>
              </li>
              <li class="menu-item">
                <a href="{% url 'medical:medtracker' %}"
                  >Medical Requirements Upload</a
                >
              </li>
              <!-- <li><a href="{% url 'medical:insurance_eligibility' %}">Emergency Health Assistance</a></li> -->
              <li class="menu-item">
                <a href="{% url 'medical:dentalservice' %}"
                  >Dental Services Availment</a
                >
              </li>
              {% endif %}

              <br /><br /><br /><br />
            </ul>
          </nav>
        </div>
        <div class="overlay hidden"></div>
      </section>
    </main>
    <!-- </div>  -->
    <script>
      const sidebar = document.querySelector(".sidebar-nav");
      const overlay = document.querySelector(".overlay");

      document.querySelector(".mobile-menu").addEventListener("click", () => {
        sidebar.classList.add("visible");
        sidebar.classList.remove("hidden");
        overlay.classList.add("visible");
        overlay.classList.remove("hidden");
      });

      document.querySelector(".close-btn").addEventListener("click", () => {
        sidebar.classList.add("hidden");
        sidebar.classList.remove("visible");
        overlay.classList.add("hidden");
        overlay.classList.remove("visible");
      });

      document.querySelector(".menu-item").addEventListener("click", () => {
        sidebar.classList.add("hidden");
        sidebar.classList.remove("visible");
        overlay.classList.add("hidden");
        overlay.classList.remove("visible");
      });
    </script>
    <script src="{% static 'scripts/jquery/jquery-3.7.1.min.js' %}"></script>
    <script src="{% static 'scripts/newmain.js' %}"></script>
    {% block extra_js %}{% endblock %}
    {% if user.is_authenticated %}
        {% if user.is_staff %}
            <!-- Admin Dashboard Section -->
            <div class="row">
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">Total Patients</h5>
                            <p class="card-text">{{ total_patients }}</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">Pending Clearances</h5>
                            <p class="card-text">{{ pending_clearances }}</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row mt-4">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            Recent Examinations
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Student ID</th>
                                            <th>Name</th>
                                            <th>Date</th>
                                            <th>Action</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for exam in recent_examinations %}
                                        <tr>
                                            <td>{{ exam.student.student_id }}</td>
                                            <td>{{ exam.student.get_full_name }}</td>
                                            <td>{{ exam.date_created|date:"F d, Y" }}</td>
                                            <td>
                                                <button class="btn btn-primary btn-sm">View Details</button>
                                            </td>
                                        </tr>
                                        {% empty %}
                                        <tr>
                                            <td colspan="4" class="text-center">No recent examinations found.</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        {% else %}
            <!-- Student Dashboard Section -->
            {% if patient %}
            <div class="row">
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-header">
                            Personal Information
                        </div>
                        <div class="card-body">
                            <p><strong>Age:</strong> {{ patient.age }}</p>
                            <p><strong>Blood Type:</strong> {{ patient.bloodtype }}</p>
                            <p><strong>Height:</strong> {{ patient.height }} cm</p>
                            <p><strong>Weight:</strong> {{ patient.weight }} kg</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-header">
                            Medical History
                        </div>
                        <div class="card-body">
                            {% if medical_history %}
                                <ul class="list-unstyled">
                                    {% if medical_history.tuberculosis %}<li>✓ Tuberculosis</li>{% endif %}
                                    {% if medical_history.hypertension %}<li>✓ Hypertension</li>{% endif %}
                                    {% if medical_history.heart_disease %}<li>✓ Heart Disease</li>{% endif %}
                                    {% if medical_history.asthma %}<li>✓ Asthma</li>{% endif %}
                                </ul>
                            {% else %}
                                <p>No medical history recorded.</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-header">
                            Risk Assessment
                        </div>
                        <div class="card-body">
                            {% if risk_assessment %}
                                <ul class="list-unstyled">
                                    {% if risk_assessment.cardiovascular_disease %}
                                        <li>✓ Cardiovascular Disease</li>
                                    {% endif %}
                                    {% if risk_assessment.chronic_lung_disease %}
                                        <li>✓ Chronic Lung Disease</li>
                                    {% endif %}
                                    {% if risk_assessment.pwd %}
                                        <li>✓ PWD: {{ risk_assessment.disability }}</li>
                                    {% endif %}
                                </ul>
                            {% else %}
                                <p>No risk assessment recorded.</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            {% else %}
                <div class="alert alert-warning">
                    No medical records found. Please complete your medical form.
                    <a href="{% url 'main:patient_form' %}" class="btn btn-primary ml-3">Complete Medical Form</a>
                </div>
            {% endif %}
        {% endif %}
    {% endif %}
  </body>
</html>
